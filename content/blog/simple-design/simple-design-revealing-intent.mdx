---
title: 简单设计之揭示意图
date: '2025-02-08'
tags:
  - simple design
published: true
brief: >-
  简单设计之揭示意图从四个维度展开：概念意图（用业务共识词汇命名，避免行外话）、行为意图（用业务动词准确表达行为，如park/pick而非get/set）、关系意图（用is-a判断继承合理性，用has-a处理组合关系）、执行意图（分层结构化表达执行过程）。通过OOBootcamp停车场场景的代码示例，展示了如何让代码成为业务的镜子，使业务人员也能读懂代码，让代码可理解性成为可持续开发的基础。
---

> 我是谁？ -- 概念意图
>
> 我要做什么？ -- 行为意图
>
> 我跟他人的关系是什么？ -- 关系意图
>
> 我会怎么做？ -- 执行意图
>



##### 揭示了什么意图？


“「统一语言」如今也不是设么新鲜词了，走到哪里说几乎都能听到，在咱们这次的OOBootcamp我听小伙伴提了多次，那到底什么是统一语言？你用业务人员提供的业务概念来命名了吗？你有自己在创造各种业务沟通过程中从未出现的新词汇吗？停车记录，哪里来的「停车记录」词汇呢？之前澄清需求有提到这个吗？”袁帅在会议室声音有点激动，清扬刚好从门口路过，她猜到袁帅又在一如既往开“怼”了。



随即，她小心翼翼推开门，透过缝隙看到两台大电视机的屏幕上并行显示着一对学员业务拆分的Task列表，学员的Task出现了「停车记录」这样的通用技术词汇，触及了袁帅的敏感地带，他一番连环问后，两眼余光未退，虽炯炯有神，但毫无攻击性。被“怼”的Pair神情显然处也在亢奋的状态。



清扬正好对简单设计充满热情，恰巧来到了简单设计下一站：「揭示意图」。此时懵懵懂懂地她对「揭示意图」虽找到了一些感觉，但还是没有明晰的答案。



怀着疑惑，她去倒了杯水，又折回来悄悄推开门，溜到会议室的角落，期待从OOBootcamp这次探讨中收获一些灵感。



“我们换一组Pair，你俩的Task下去做一些重构哈~” 只见一开始还剑拔弩张的元力搭档经过刚才的一番提问和思辨，双双点头表示接纳，且表情面带舒展的笑容。





##### 概念意图


袁帅始终认为：如果一个概念在业务上没有出现过，或者无法在沟通业务过程中形成共识，那它可能就是一个坏味道。这些年，无论是他自己写代码，还是看别人的代码，他都始终会把这些命名拿到业务上下文去测试一下。



快速Review完另一对Pair的Task，七嘴八舌讨论对齐了一些小点，没什么大问题，然后紧接着切换到代码。

```java
public class ParkingValet {
    private List<CarPark> carParks;
    // ...
}
```



“ParkingValet是啥？清扬你能看懂吗？” 清扬意外被Q到了，她还以为自己未被发现。“额...刚毕业的停车小弟？”清扬记得上一个Task在讨论的是「刚毕业的停车小弟」需求，突然又补充了一句：“咦，不对，我看刚才咱们在讨论的是「GraduateParkingBoy」呢？课件上也这么写的...” 大家听到课件两字不约而同地笑出声来。



“不只是课件上这么写的，Trello上的用户故事卡也是这么写的哦~” 一副“看热闹不嫌事大”的Jeany补了一刀，袁帅立即抛给她一个感谢的眼神。Jeany不知道这是多少次补刀了，每次总能补到袁帅的心坎上，还能让学员感受到满满的善意。



“哦哦，确实，我们俩把这个忽略了，还花了很多时间去查各种词典，才挑了个感觉比较高级的词汇。”还未等袁帅开问，代码的作者卢勇开始“自首”了。



“CarPark又是什么？停车公园？”自己组的另一对Pair张莉搭档也按捺不住发问，「停车公园」一出，全场都笑了，袁帅也没忍住。



“CarPark是停车场啊！额...... 懂了，「ParkingLot」，PO上一次就跟我们沟通澄清过，提到这个业务词汇。” 刚才还在据理力争的卢勇立即一副无辜求原谅的表情，逗得大家哈哈大笑。



快过试用期的清扬此时并没有觉得袁帅在小题大做，因为这半年来，她在代码库中踩过坑，尝过苦，当然也挖过坑。**明明业务沟通澄清是使用了大家都达成一致词汇，在写代码的时候却不用，反而要去造一些自己觉得高大上，却跟业务概念不匹配的词汇**。



她经常在代码库中看到一些莫名奇妙的词汇，然后需要花时间去理解其含义，到都来其实是一个业务概念的另一个命名而已，着实让人费解。这又让她想起来上次跟袁帅吃饭时提到的**「行外话」**。





##### 行为意图


袁帅最近发现不少来自交付一线的小伙伴比较迷恋get，只要是返回某某对象的行为方法，就喜欢get***，这种模式他曾赋予了一个名字 -- Get一切。这不，说曹操曹操就到，刚看完卢勇搭档的代码，汪羽搭档show出了代码：

```java
public class ParkingLot {
    
    public Ticket carIn(Car ticket) {
        // ...
    }
    
    public Car getCar(Ticket ticket) {
        // ...    
    }
    

    public boolean hasTicket(Ticket ticket) {
        // ...
    }
}
```

“既然都carIn了，那为啥不carOut呢”，张莉又敏锐地发现问题，抢先回答道。



“额，我们是觉得getCar好理解一些，获得车嘛，对不对？” 汪羽解释道，但声音略显没底气。



“获得车？怎么获得车呢？什么时候要获得车呢？获得车在真实业务场景车叫什么呢？”袁帅面朝汪羽一连三问。



“哦，业务是取车的场景，取车叫pick”。汪羽如梦初醒，急忙补充：“这么说carIn也不合适，carIn想表达停车，用park更合适。”汪羽显露出来的“求生欲”让小伙伴们乐起来，这次袁帅没有加入，继续问问题：“还有么？”



"hasTicket这个方法也不好，会到实际业务场景，应该是有没有车，而不是有没有票，hasCar或者containsCar会更合适。"卢勇做了个不错的补充。



短短一个ParkingLot类，仅有的三个行为都缺点什么，你说它错，也没有任何错，因为功能是正确的，可是它却理解起来比较费劲，可理解性必然会造成后期的维护成本的提升。如果用软件质量的四个标准来衡量，也充其量只满足了第一条：

+ **功能正确（****✔️****）**
+ **可持续开发**
+ 安全内建
+ 为生产环境而构建



在OOBootcamp目前的设计中，主要聚焦在前两条，可持续开发是重中之重，可持续开发的核心点是代码的可理解性。



行为意图怎么更好的揭示呢？仍然**要回归的业务**，停车场停车功能、取车功能，那代码命名就park、pick；复印有复印功能，打印机有打印功能，那就用copy、print，而不是用execute或者do；收银机有结算功能，那就用settle，而不是用calculateOrderPrice，保单有理赔功能，那就用claim，而不是用handleAccidents；账户有取款功能，那就用withDrawMoney，而不是用fetchOutMoney。





##### 关系意图


在对象建模中，对象之间的关系如果不合理，影响会更大，因为它关系到多个个体构成的更为复杂的结构。比如，常用的继承类（抽象或非抽象基类），组合，实现行为接口。



那什么时候使用继承？什么时候使用组合？什么时候有需要抽象出行为接口？这些都是困扰着很多OO程序员的建模问题，这也是在OOBootcamp中，袁帅经常用来引发“群架”的问题。



接下来大家就因为徐乐搭档的代码吵了起来：



```java
public class GraduateParkingBoy {
    private List<ParkingLot> parkingLots;
   
    public Tickte park(Car car) { //... }     
    public Car pick(Ticket ticket) { //... }
}
        
public class SmartParkingBoy extends GraduateParkingBoy { 
    @Override
    public Tickte park(Car car) { //... }     
}

```



“SmartParkingBoy继承GraduateParkingBoy，PO有提到过SmartParkingBoy是一个GraduateParkingBoy么？”袁帅汗毛立马竖起来，开始发难了。



“不都一样么，聪明的停车小弟是一个刚毕业的停车小弟也没有问题啊，虽然两个小弟的停车方式不一样，我继承后把park复写一下就好了啊！然后我还可以直接复用pick行为” 徐乐先发制人，在被怼之前先呈上辩词。



“哦，你这有问题，继承虽然能够用来做复用功能，但是你这好像最基本的业务概念关系就不合理。” 元力按捺不住了，边说边看向袁帅，貌似在等待袁帅的肯定的眼神。



“是，我知道书上说判断继承是否合理，用is-a来衡量一下，我觉得有时候不要过于拘泥，能便捷完成功能更重要吧。” 许乐补充道。



“如果只看功能正确，那你这确实没问题，可是你这代码让新人很难理解呀，毕竟我们建立了一种共识继承表达的意图是：is-a，而你这个明显不符合 is-a，这个模型拿给业务人员，显然是会引发困惑的。”元力又把球踢了回来。



“说的很好，「**这个模型拿给业务人员，显然是会引发困惑的**」。而这个业务人员除了真正的业务人员，还有未来正常理解了业务需求的开发人员。如果你的模型业务人员看不懂，那很可能就不是一个好模型，说明它没有准确表达业务意图。” 袁帅抓住时机来回到业务。



“是呀，如果不考虑这个模型的业务表现力，那一开始GraduateParkingBoy直接继承自ParkingLot不更来得快！” 元力被表扬后略微有点“上头”了。



“至于你说的为了复用pick行为，继承确实是复用的一种方式，但继承首先要满足概念本身的关系合理性，is-a是帮助你去做判断的一个基本工具，如果你识别出了重复味道，也可以考虑将重复的pick行为提取到一个公共的基类。” 袁帅趁热打铁。



“是的，可以抽取一个抽象的基类ParkingBoy，定义park和pick两个方法，由于pick行为是相同的，park有各自的实现，所以pick是一个具体被两个子类复用的方法，park是一个抽象的行为接口，两个子类各自实现。” 元力头脑很清晰，补充了一个自己的实现。袁帅在白板上迅速画出了类图：

![画板](/images/simple-design/parking-boy-class-diagram.webp)



一图抵千言，徐乐看到这个类图若有所思的点着头，她面部露出了豁然开朗的微笑。清扬在角落格外认真地在听和看，**「模型要让业务人员能看懂」**这个点让她印象深刻。此时她脑海里浮现出之前学习OO建模的时候，is-a、has-a，like-a这些用来判断关系的词汇，此时她回顾到业务源头再去思考这些短语，感受到不同的含义。



“大家可能还听过has-a，like-a，后面的ParkingManager需求会重点掰扯这个，其实不管什么关系的模型，都要尝试回到业务上去讲，业务上的关系合理不合理？业务人员能不能看懂？这些都是咱们要去回答的问题。”





##### 执行意图


如果说概念意图回答了 “我是谁？”，行为意图回答了 “我要做什么？” ，关系意图回答了 “我跟他人的关系是什么？” 那在抵达目标的路途是否顺畅？过程是否容易被理解？是否具备良好的分层结构化表达？袁帅把这个称作执行意图。执行意图在尝试回答 “我会怎么做？” 它是一个偏实现过程细节的意图。



多年前，袁帅在《敏捷技能修炼：敏捷软件开发与设计的最佳实践》一书结识了「意图导向编程」，便开始慢慢刻意通过分层结构化表达执行过程来揭示执行意图，执行过程逻辑从抽象到具体、执步骤清晰，结构化良好，这些都会大大提升代码的可理解性。



在完成复杂的业务逻辑中，通常会在执行过程中需要将代码进一步分解来降低认知负载，比如常见的「解释型变量解释复杂的条件表达式」、「常量代替魔鬼数字」、「查询方法取代一段复杂逻辑」都是在凸显代码的执行过程中的意图，让其理解起来更加容易，阅读起来的负担更小。



OOBootcamp因为执行过程目前还没有那么复杂，他就着徐乐代码给大家做了个简单的示范：

```java
public class ParkingLot implements Parkable {
    private final int capacity;
    private final Map<Ticket, Car> parkedCars = new HashMap<>();

    public ParkingLot(int capacity) { this.capacity = capacity; }

    public Ticket park(Car car) {
        if (isFull()) { throw new ParkingLotFullException();}
        
        Ticket ticket = new Ticket();
        parkedCars.put(ticket, car);
        return ticket;
    }

    public boolean isFull() {
        return parkedCars.size() >= capacity;
    }
}

```

“ParkingLot.park()方法，将isFull() 提取出来其实就是提升执行意图的方式，在复杂的执行过程中，这种做法的好处会更加明显，而且这个isFull()不仅自己调用了，外部也有消费者，能够提供复用。另外第10 ~ 12行也可抽取出一个方法，private Ticket park(car: Car)，这样提供外部消费者的park() 执行过程就是两步，isFull + park，执行意图进一步结构化了。” 由于业务简单，袁帅没有让徐乐现场重构，只是借代码说明了执行意图的含义。



眼看马上21:00了，袁帅做了个简单总结：

“**揭示意图的意图初衷就是统一语言中的那个真正共识统一的语言，其实没那么多高大上的东西，你用沟通共识过的业务词汇来建（命）模（名）了么？那如何更好地做到这一点呢？始终保持审视自己，不行就让别人来审视你。我给大家提供一些坏味道列表，从形上消除：「域冗余」、「码尾禅」、「层错综」。当然要尽可能规避神上的：「伪修饰」、「行外话」，尤其是「行外话」。**”



大家听着一脸困惑，清扬见状自告奋勇要求被拉进学习群里，给大家分享了两篇文章：

+ [你的代码会说话吗？（上）](https://insights.thoughtworks.cn/how-to-write-clean-code-1/)
+ [你的代码会说话吗？（下）](https://www.yuque.com/yuanshenjian/clean-coder/will-your-code-speak-well-2)



##### 
##### 如何做到简单呢？


结束了，袁帅走到清扬旁边，只见她在一张卡片上写心得：**揭示意图要力求准备地表达业务概念，跟业务人员保持沟通，对业务术语达成共识，统一理解。**



感知到袁帅站到跟前，清扬抬头朝他一笑，袁帅也早已准备好了大拇指，并示意清扬把手里的卡片递给他瞅瞅：

![画板](/images/simple-design/simple-design-summary.webp)



看到清扬随身带着之前探讨 [简单设计](https://www.yuque.com/yuanshenjian/clean-coder/simple-design) 过程中的一些手卡笔记，明白她肯定是有什么问题要找他讨论。“走，边走边聊？”



“帅哥，简单设计，我怎么感觉其实不简单啊”。清扬边说边挠头。



“哪里不简单呢？”



 “「通过测试」这个好说，「消除重复」也相对明确，「揭示意图」这个感觉就是如鱼饮水，冷暖自知。当然，「优先级原则」我算是明白了。” 清扬一气呵成，可见她已经熟记于心了。



“是啊，简单设计四个字说起来简单，确实很考验一个人的功底，尤其是「揭示意图」。” 袁帅对清扬表示赞同，停顿了一会儿继续讲：“除了训练营，其实功夫在平时，平时多关注这些“不起眼”的命名，尝试跳出技术视角，花点时间琢磨业务，另外，多跟非DEV角色沟通，他们能很好地照出你的不足。”



“咱们现在说的「揭示意图」更多聚焦在基础也本真的地方 -- 命名。说到命名，从一组业务活动中提炼抽象合适的概念，这个活不是人人都能做好的。前几天我们一帮人跟CTO喝酒闲（学）聊（习），有件事情让我觉得不可思议 -- 一个小伙伴提到某个2年的产品系统，模型中竟然没出现真实用户日常使用场景时都会脱口而出的概念，缺失了最基本的业务表现力。” 袁帅把上周的一个见闻分享了出来。



“当时有人开玩笑说 ：起名字，来个武林高手帮你把名字起好了拿给你看，你可能会说这有啥，不就是几个名词么，谁不会啊！可是当自己去做的时候，绞尽脑汁都不一定能想出个合适的名字。”袁帅说着犹如又身临其境般苦笑起来。



“是啊，别说那些需要从0-1的创新产品系统了，就现在一些交付项目上，已经有明确的业务需求和业务语言，开发人员都能整出个花样命名来。” 清扬受到这种胡乱命名困扰太深，发起牢骚来。



“嗯嗯，平时不妨在触手可及的地方放几本基础的书，比如：《编写可读代码的艺术》、《重构》、《修改代码的艺术》、《实现模式》，经常翻翻，咀嚼咀嚼。当然，更好的提升方式跟人交互，把握好结对编程、Code Review，在这过程被怼。说到被怼，我刚入职的那几个月，在Clean Code方面的成长之快让我印象深刻，每天自己写的代码被怼得不想说话。”Jeany又分享了她那段痛并快乐的“黑”历史。



“哈哈，Jeany正好提醒了我。清扬，你知道公司最近在推的[Sw Dev SDP（Sensible Default Practices）](https://docs.google.com/presentation/d/1nI20qe4a-OzP18bkgPJet3we4Qfs8bhYH6RKi1lu9ZE/edit#slide=id.g12afadff4c2_0_1)吗？里面提到了结对编程和TDD，加上咱们现在讨论简单设计，另外再加一个重构，（重构被归纳到SDP的「质量和债务有效管理」中），就构成了极限编程的三圈模型中最内圈的四项实践。”说完刚好路过一块白板墙，袁帅拿起白板笔开始画了起来：



![画板](/images/simple-design/xp-practices.webp)



“这四个名词我经常在各种地方听到大家在讲，有称赞也有吐槽的。咦，外面两圈是什么？” 清扬看得非常认真，好奇地问道。



“时间关系，我就先不画外圈了”。袁帅其实也有点担心再继续画下去可能会翻车，就“搪塞”过去了。咳了一声继续说：“回到最初的问题上，**要怎么做到简单设计呢？除了自己背着一箩筐书跟时间赛跑，打磨自身手艺，还需要在团队中跟其他成员配合打出一套组合拳，也就是现在内圈的这一套。**”



“嘿，赶紧收拾去赶公交吧，一会再晚你的公交就下班了。”Jeany总是很及时的提醒这些“一不小心就迷失自己”的人们。



“呀，那我赶紧咯，后面找机会再好好聊聊这套组合拳。”袁帅加快了步伐，因为今天可以送他去某个地方的公交真的快要下班了。



“清扬，咱们找时间琢磨一下这几项实践，争取出点难题，下次考一考袁帅~” Jeany说完，两人会心一笑，各自也不紧不慢地收拾起来。



“两位美女再见~” Jeany和清扬闻声抬头，只见袁帅被关进了电梯。